import{r as t,c as e,h as a,g as i}from"./p-df6a2f70.js";import"./p-d8060b98.js";import{n as s,r,d as o,t as n,o as h}from"./p-6abc1eda.js";var l,c;function g(t,e){for(let a=0;a<e.length;a++){const i=e[a];if(t===i.name)return i}return null}!function(t){t.Area="Area",t.Bubble="Bubble",t.Cal="Cal",t.Candlestick="Candlestick",t.Combo="Combo",t.Geo="Geo",t.Hbar="Hbar",t.Line="Line",t.Ohlc="Ohlc",t.Pie="Pie",t.Sankey="Sankey",t.Scatter="Scatter",t.Unk="Unk",t.Vbar="Vbar"}(l||(l={})),function(t){t.D2="2D",t.D3="3D"}(c||(c={}));const u=(t,{series:e,axis:a})=>{if(!t||!e)return[];const i=[],s=g(a,t.columns);return s&&i.push(s),e.map(e=>{const a=g(e,t.columns);a&&i.push(a)}),i},C=(t,e,a)=>{if(!t)return[];const i=[];return t.rows&&t.rows.forEach(t=>{const h=t.cells,l=[];e.forEach((t,e)=>{const i=h[t.name];if(i&&i.obj){const t=a&&e>0;if(o(i.obj)){const e=function(t){return t.obj?s(t.obj.k).value():s(t.value).value()}(i);l.push(e),t&&l.push(e.toString())}else if(n(i.obj)){const e=function(t){let e="YYYYMMDD";if(t.obj){const a=t.obj;return"D8"===a.t&&"*DMYY"===a.p&&(e="DDMMYYYY"),r(t.obj.k,e)}return r(t.value,"DD/MM/YYYY")}(i).toDate();l.push(e),t&&l.push(e.toString())}else l.push(i.obj.k),t&&l.push(i.value)}}),i.push(l)}),i};class d{constructor(a){t(this,a),this.types=[l.Hbar],this.colors=[],this.legend=!0,this.stacked=!1,this.showMarks=!1,this.version="45.2",this.kupChartClicked=e(this,"kupChartClicked",6)}componentDidLoad(){if(this.axis&&this.series&&google){document.querySelectorAll(`link[href^="https://www.gstatic.com/charts/${this.version}/css"]`).forEach(t=>this.el.shadowRoot.appendChild(t.cloneNode()));try{this.loadGoogleChart()}catch(t){console.error(t)}}}componentWillUpdate(){this.gChart&&this.gChart.clearChart()}componentDidUpdate(){this.loadGoogleChart()}loadGoogleChart(){google.charts.setOnLoadCallback(this.createChart.bind(this))}createGoogleChart(){if(this.isComboChart())return new google.visualization.ComboChart(this.chartContainer);if(1===this.types.length)switch(this.types[0]){case l.Area:return new google.visualization.AreaChart(this.chartContainer);case l.Bubble:return new google.visualization.BubbleChart(this.chartContainer);case l.Cal:return new google.visualization.Calendar(this.chartContainer);case l.Candlestick:return new google.visualization.CandlestickChart(this.chartContainer);case l.Geo:return new google.visualization.GeoChart(this.chartContainer);case l.Hbar:return new google.visualization.BarChart(this.chartContainer);case l.Line:return new google.visualization.LineChart(this.chartContainer);case l.Pie:return new google.visualization.PieChart(this.chartContainer);case l.Sankey:return new google.visualization.Sankey(this.chartContainer);case l.Scatter:return new google.visualization.ScatterChart(this.chartContainer);default:return new google.visualization.ColumnChart(this.chartContainer)}}getMainChartType(){return this.types.length>0?this.types[0]:l.Unk}isComboChart(){return this.types.length>1}createGoogleChartOptions(){const t={is3D:c.D3===this.asp};return this.colors&&this.colors.length>0&&(t.colors=this.colors),this.width&&(t.width=this.width),this.height&&(t.height=this.height),this.legend||(t.legend={position:"none"}),!this.stacked||l.Hbar!==this.getMainChartType()&&l.Vbar!==this.getMainChartType()||(t.isStacked=!0),this.graphTitle&&(t.title=this.graphTitle,t.titleTextStyle={},this.graphTitleColor&&(t.titleTextStyle.color=this.graphTitleColor),this.graphTitleSize&&(t.titleTextStyle.fontSize=this.graphTitleSize)),this.isComboChart()&&(t.series={},this.types.forEach((e,a)=>{let i="bars";l.Line===e?i="line":l.Area===e&&(i="area"),t.series[a.toString()]={type:i}})),t}createChart(){const t=u(this.data,{axis:this.axis,series:this.series}),e=C(this.data,t,this.showMarks),a=[];for(let e=0;e<t.length;e++)a.push({label:t[e].name}),e>0&&this.showMarks&&a.push({type:"string",role:"annotation"});this.gChartDataTable=new google.visualization.arrayToDataTable([a,...e]),this.gChartView=new google.visualization.DataView(this.gChartDataTable),this.gChart=this.createGoogleChart();const i=this.createGoogleChartOptions();this.gChart.draw(this.gChartView,i),google.visualization.events.addListener(this.gChart,"select",this.onChartSelect.bind(this))}onChartSelect(){const t=this.gChart.getSelection()[0];if(t){const e={};if(t.date){if(e.datetime=t.date,!t.row&&0!=t.row)return;{const a=this.gChartView.getTableRowIndex(t.row);e.row=this.data.rows[a]}}else{const a=t.row,i=t.column,s=this.gChartView.getTableRowIndex(null!=a?a:0);if(e.row=this.data.rows[s],this.series.length>1){let t=this.gChartView.getTableColumnIndex(null!=i?i:0);"annotation"===this.gChartDataTable.getColumnProperty(t,"role")&&--t,e.column=h(this.data.columns,this.series[t-1])}else e.column=h(this.data.columns,this.series[0])}this.kupChartClicked.emit(e)}}render(){return a("div",{id:"chart",ref:t=>this.chartContainer=t})}get el(){return i(this)}}export{d as kup_chart};