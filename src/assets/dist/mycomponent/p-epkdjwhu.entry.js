import{r as e,c as t,h as i}from"./p-df6a2f70.js";import"./p-d8060b98.js";import{f as s,p as o,s as n,e as l,k as c,l as a,u as h,n as r,i as d,a as u}from"./p-6abc1eda.js";import{P as p}from"./p-8cdcd574.js";class g{constructor(i){e(this,i),this.columns=1,this.sortEnabled=!1,this.filterEnabled=!1,this.multiSelection=!1,this.showSelection=!0,this.enableRowActions=!1,this.pagination=!1,this.pageSize=10,this.globalFilterValue="",this.collapsedSection={},this.selectedRows=[],this.currentPage=1,this.visibleColumns=[],this.rows=[],this.filteredRows=[],this.kupBoxClicked=t(this,"kupBoxClicked",6),this.kupBoxSelected=t(this,"kupBoxSelected",6),this.kupAutoBoxSelect=t(this,"kupAutoBoxSelect",6),this.kupRowActionMenuClicked=t(this,"kupRowActionMenuClicked",6),this.kupRowActionClicked=t(this,"kupRowActionClicked",6)}recalculateRows(){this.initRows()}onDataChanged(){this.initVisibleColumns(),this.initRows(),this.checkLayout()}onLayoutChanged(){this.checkLayout()}onSelectBoxChanged(){this.handleAutomaticBoxSelection()}componentWillLoad(){this.onDataChanged()}componentDidLoad(){this.handleAutomaticBoxSelection(),document.addEventListener("click",this.clickFunction.bind(this))}componentDidUnload(){document.removeEventListener("click",this.clickFunction.bind(this))}async loadRowActions(e,t){e.actions=t,this.rowActionMenuOpened=e}getColumns(){return this.data&&this.data.columns?this.data.columns:[{title:"",name:"",size:0}]}initVisibleColumns(){this.visibleColumns=this.getColumns().filter(e=>!e.hasOwnProperty("visible")||e.visible)}getRows(){return this.data&&this.data.rows?this.data.rows:[]}initRows(){if(this.filteredRows=this.getRows(),this.filterEnabled&&this.globalFilterValue){const e=this.visibleColumns;let t=e.length,i=[],o=0;for(;t-- >0;)i.push(e[o++].name);this.filteredRows=s(this.filteredRows,null,this.globalFilterValue,i)}this.rows=this.sortRows(this.filteredRows),this.pagination&&(this.rows=o(this.rows,this.currentPage,this.pageSize))}sortRows(e){let t=e;return this.sortBy&&(t=n(t,[{column:this.sortBy,sortMode:u.A}])),t}checkLayout(){if(this.layout)return void(this.boxLayout=this.layout);const e={horizontal:!1,sections:[],style:{textAlign:"center"}},t=this.visibleColumns;let i=t.length,s=[],o=0;for(;i-- >0;)s.push({column:t[o++].name});e.content=s,this.boxLayout={sections:[e]}}onSortChange(e){this.sortBy=e.value.id,this.initRows()}onGlobalFilterChange({detail:e}){this.globalFilterValue=e.value}isSectionExpanded(e,t){return!(!e.id||!t.id)&&this.collapsedSection[t.id]&&this.collapsedSection[t.id][e.id]}handleAutomaticBoxSelection(){this.selectBox&&this.selectBox>0&&this.selectBox<=this.rows.length&&(this.selectedRows=[],this.selectedRows.push(this.rows[this.selectBox-1]),this.kupAutoBoxSelect.emit({row:this.selectedRows[0]}))}checkIfElementIsActionMenuIcon(e){return!(!e.tagName||!e.parentElement)&&"svg"===e.tagName&&e.parentElement.classList.contains("row-actions-toggler")}onBoxClick({target:e},t){if(!(e instanceof HTMLElement))return;let i=e,s=i.classList;for(;!s.contains("box-object")&&!s.contains("box-section")&&!s.contains("box")&&null!==(i=i.parentElement);)s=i.classList;let o=null;s.contains("box-object")&&(o=i.dataset.column),this.kupBoxClicked.emit({row:t,column:o}),this.multiSelection?this.onSelectionCheckChange(t):this.selectedRows=[t]}onSelectionCheckChange(e){const t=this.selectedRows.indexOf(e);t>=0?(this.selectedRows.splice(t,1),this.selectedRows=[...this.selectedRows]):this.selectedRows=[...this.selectedRows,e],this.kupBoxSelected.emit({rows:this.selectedRows})}toggleSectionExpand(e,t){if(t.id)if(e.id){if(this.collapsedSection[t.id]){const i=this.collapsedSection[t.id];i[e.id]=!i[e.id]||!i[e.id]}else this.collapsedSection[t.id]={},this.collapsedSection[t.id][e.id]=!0;this.collapsedSection=Object.assign({},this.collapsedSection)}else console.error("cannot expand / collapse a section of a row without ad id");else console.error("cannot expand / collapse a section withoun an ID")}onRowAction(e){e&&(e!==this.rowActionMenuOpened?e.actions?this.rowActionMenuOpened=e:this.kupRowActionMenuClicked.emit({row:e}):this.rowActionMenuOpened=null)}onRowActionClicked(e,t,i){this.kupRowActionClicked.emit({row:e,action:t,index:i})}clickFunction(e){try{const t=e.composedPath();for(let e of t)if(this.checkIfElementIsActionMenuIcon(e))return}catch(t){if(this.checkIfElementIsActionMenuIcon(e.target))return}this.rowActionMenuOpened=null}handlePageChanged({detail:e}){this.currentPage=e.newPage}renderRow(e){const t=[...this.visibleColumns];let s=null,o=e.layout;o||(o=this.boxLayout);let n=!1;if(o){o.horizontal&&(n=!0);const i=o.sections;let l=i.length,c=0;l>0&&(s=[]);const a={horizontal:n};for(;l-- >0;)s.push(this.renderSection(i[c++],a,e,t))}const l=this.selectedRows.includes(e);let c=null;this.multiSelection&&(c=i("div",{class:"box-selection"},i("input",{type:"checkbox",checked:l,onClick:e=>e.stopPropagation(),onChange:()=>this.onSelectionCheckChange(e)})));let a=null;if(this.enableRowActions){const t={"row-action-menu":!0,open:e===this.rowActionMenuOpened};let s=null;if(e.actions){const t=e.actions.map((t,s)=>i("li",{tabindex:"0",onClick:()=>this.onRowActionClicked(e,t,s)},i("div",{class:`icon ${t.icon}`}),i("div",{class:"text"},t.text)));s=i("ul",null,t)}a=i("div",{class:"row-actions-wrapper"},i("div",{class:"row-actions-toggler"},i("svg",{version:"1.1",width:"24",height:"24",viewBox:"0 0 24 24",onClick:()=>this.onRowAction(e)},i("path",{d:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"})),i("div",{class:t},s)))}let h=null;return e.badges&&e.badges.length>0&&(h=e.badges.map(e=>i("kup-badge",{text:e.text,position:e.position,icon:e.icon,class:"centered"}))),i("div",{class:"box-wrapper"},i("div",{class:{box:!0,selected:this.showSelection&&l,column:!n},onClick:t=>this.onBoxClick(t,e)},c,s,h),a)}renderSection(e,t,s,o){let n=null;if(e.sections&&e.sections.length>0){const t=e.sections;let i=t.length,l=0;for(i>0&&(n=[]);i-- >0;)n.push(this.renderSection(t[l++],e,s,o))}else if(e.content){const t=e.content;let i=t.length,l=0;for(i>0&&(n=[]);i-- >0;)n.push(this.renderBoxObject(t[l++],s,o))}else if(o.length>0){const e=o[0];o.splice(0,1),n=this.renderBoxObject({column:e.name},s,o)}const l=this.isSectionExpanded(s,e),c=!!e.columns,a={"box-section":!0,open:l,column:!c&&!e.horizontal,grid:c,titled:!!e.title,"last-child":!e.sections||0===e.sections.length},h=e.style||{};e.dim&&t&&(h.flex=`0 0 ${e.dim}`,t.horizontal?h.maxWidth=e.dim:h.maxHeight=e.dim),c&&(h["grid-template-columns"]=`repeat(${e.columns}, 1fr)`);let r=null;if(e.collapsible){a["collapse-section"]=!0;let t="";t=e.title?e.title:l?"Collassa":"Espandi",r=i("div",{class:a,style:h},i("div",{class:{content:!0}},n),i("div",{class:"header",role:"button",onClick:t=>{t.stopPropagation(),this.toggleSectionExpand(s,e)}},i("div",{class:"header-content"},i("span",null,t),i("span",{class:"mdi mdi-chevron-down"}))))}else{const t=e.title?i("h3",null,e.title):null;r=i("div",{class:a,style:h},t,n)}return r}renderBoxObject(e,t,s){let o=null,n={};if(e.value)o=e.value;else if(e.column){const u=t.cells[e.column];if(u){let t=-1;for(let i=0;i<s.length;i++)if(s[i].name===e.column){t=i;break}if(t>=0&&s.splice(t,1),u.style&&(n=Object.assign({},u.style)),l(u.obj)){let e=null;u.config&&u.config.badges&&(e=u.config.badges),o=i("kup-image",{src:u.value,badges:e})}else if(c(u.obj))o=i("kup-button",Object.assign({},a(u)));else if(h(u.obj)){const e=r(u.value).value();let t=!1,s=null;const n={};u.config&&(t=!!u.config.hideLabel,u.config.hasOwnProperty("labelText")&&(s=u.config.labelText),u.config.foregroundColor&&(n["--kup-pb_foreground-color"]=u.config.foregroundColor)),o=i("div",{style:n},i("kup-progress-bar",{value:e,labelText:s,hideLabel:t}))}else o=d(u.obj)?i("span",{class:`icon ${u.value}`}):u.value}}return i("div",{"data-column":e.column,class:"box-object",style:n},o)}render(){let e=null;if(this.sortEnabled){let t={value:"",id:""};const s=[{value:"",id:""},...this.visibleColumns.map(e=>{const i={value:e.title,id:e.name};return e.name===this.sortBy&&(t=i),i})];e=i("div",{id:"sort-panel"},i("kup-combo",{displayedField:"value",items:s,initialValue:t,onKetchupComboSelected:e=>this.onSortChange(e.detail)}))}let t=null;this.filterEnabled&&(t=i("div",{id:"filter-panel"},i("kup-text-input",{placeholder:"Cerca",onKetchupTextInputUpdated:e=>this.onGlobalFilterChange(e)},i("svg",{slot:"left",version:"1.1",width:"18",height:"18",viewBox:"0 0 24 24"},i("path",{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"})))));let s=null;this.pagination&&(s=i("kup-paginator",{max:this.filteredRows.length,perPage:this.pageSize,currentPage:this.currentPage,onKupPageChanged:e=>this.handlePageChanged(e),mode:p.SIMPLE}));let o=null;if(0===this.rows.length)o=i("p",{id:"empty-data-message"},"Empty data");else{const e=this.rows;let t=e.length,i=0;for(o=[];t-- >0;)o.push(this.renderRow(e[i++]))}return i("div",null,e,t,s,i("div",{id:"box-container",style:{"grid-template-columns":`repeat(${this.columns}, 1fr)`}},o))}static get watchers(){return{globalFilterValue:["recalculateRows"],sortBy:["recalculateRows"],pagination:["recalculateRows"],pageSize:["recalculateRows"],currentPage:["recalculateRows"],data:["onDataChanged"],layout:["onLayoutChanged"],selectBox:["onSelectBoxChanged"]}}static get style(){return"\@import url(https://cdn.materialdesignicons.com/3.6.95/css/materialdesignicons.min.css);:host{--box_color:var(--kup-box_color,#707070);--box_border-color:var(--kup-box_border-color,#d0d0d0);--box_border-radius:var(--kup-box_border-radius,3px);--box_img-border-radius:var(--kup-box_img-border-radius,4px);--box_expand-panel-color:var(--kup-box_expand-panel-color,$smeup-primary);--box_hover-box-shadow:var(--kup-box_hover-box-shadow,0px 0px 7.5px 0px hsla(0,0%,50.2%,0.5));--box_titled-section-font-size:var(--kup-box_titled-section-font-size,12px);--box_titled-section-bg-color:var(--kup-box_titled-section-bg-color,#fff);--box_titled-section-top:var(--kup-box_titled-section-top,-9px)}#box-container{display:grid;grid-gap:1rem;color:var(--box_color)}#box-container *{-webkit-box-sizing:border-box;box-sizing:border-box}#box-container .box-wrapper{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#box-container .box-wrapper .box{-ms-flex-positive:1;flex-grow:1;cursor:pointer;position:relative;border-radius:var(--box_border-radius);border:1px solid var(--box_border-color);display:-ms-flexbox;display:flex;padding:3px}#box-container .box-wrapper .box.column{-ms-flex-direction:column;flex-direction:column}#box-container .box-wrapper .box.selected,#box-container .box-wrapper .box:hover{-webkit-box-shadow:var(--box_hover-box-shadow);box-shadow:var(--box_hover-box-shadow)}#box-container .box-wrapper .box .box-section{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex:1 1 1%;flex:1 1 1%;-ms-flex-wrap:wrap;flex-wrap:wrap}#box-container .box-wrapper .box .box-section.last-child{margin:3px 4px}#box-container .box-wrapper .box .box-section.column{-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-wrap:unset;flex-wrap:unset}#box-container .box-wrapper .box .box-section.column>.box-section{-ms-flex:0 0 auto;flex:0 0 auto}#box-container .box-wrapper .box .box-section.grid{display:grid}#box-container .box-wrapper .box .box-section .box-object{padding:1px 4px}#box-container .box-wrapper .box .box-section .box-object img{border-radius:var(--box_img-border-radius);height:auto}#box-container .box-wrapper .box .box-section.collapse-section .header{border-top:1px solid var(--box_border-color);color:var(--box_expand-panel-color);display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;width:100%}#box-container .box-wrapper .box .box-section.collapse-section .header .header-content{margin:.5rem;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#box-container .box-wrapper .box .box-section.collapse-section .header .header-content .mdi{margin-left:5px}#box-container .box-wrapper .box .box-section.collapse-section .content{display:none;width:100%}#box-container .box-wrapper .box .box-section.collapse-section.open .header .header-content .mdi:before{-webkit-animation:rotate-icon .5s ease-out forwards;animation:rotate-icon .5s ease-out forwards}#box-container .box-wrapper .box .box-section.collapse-section.open .content{display:block}#box-container .box-wrapper .box .box-section.titled{border:1px solid var(--box_border-color);padding-top:5px;position:relative;margin:10px}#box-container .box-wrapper .box .box-section.titled>h3{position:absolute;margin:0;padding:0 3px;top:var(--box_titled-section-top);left:5px;font-size:var(--box_titled-section-font-size);background:var(--box_titled-section-bg-color)}#box-container .box-wrapper .box .box-selection{position:absolute;top:.5rem;right:.5rem}#box-container .box-wrapper .box kup-badge{--bdg_background-color:#f89406;--kup-badge_dimension:24px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler{position:relative;width:24px;height:24px;margin-left:3px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler svg{cursor:pointer;opacity:0;fill:#545454;-webkit-transition:opacity .5s ease-out;transition:opacity .5s ease-out}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu{position:absolute;top:0;right:24px;display:none;border:1px solid var(--box_border-color);z-index:10;background:#fff;-webkit-box-shadow:0 0 7.5px 0 hsla(0,0%,50.2%,.5);box-shadow:0 0 7.5px 0 hsla(0,0%,50.2%,.5)}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul{list-style-type:none;margin:0;padding:0}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li{cursor:pointer;white-space:nowrap;padding:0 12px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;line-height:30px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li:not(:last-child){border-bottom:1px solid var(--box_border-color)}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li .icon{margin-right:5px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu.open{display:block}#box-container .box-wrapper:hover .row-actions-wrapper .row-actions-toggler svg{opacity:1}:host(.no-shadow) #box-container .box{border:none}:host(.no-shadow) #box-container .box.selected,:host(.no-shadow) #box-container .box:hover{-webkit-box-shadow:none;box-shadow:none}#filter-panel,#sort-panel{margin-bottom:1rem}#filter-panel kup-text-input{--kup-text-input_border-color:#d0d0d0;--kup-text-input_color:#545454}#filter-panel svg{fill:grey;margin-left:3px}\@-webkit-keyframes rotate-icon{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}\@-moz-keyframes rotate-icon{0%{transform:rotate(0deg)}to{transform:rotate(180deg)}}\@-o-keyframes rotate-icon{0%{transform:rotate(0deg)}to{transform:rotate(180deg)}}\@keyframes rotate-icon{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}"}}export{g as kup_box};