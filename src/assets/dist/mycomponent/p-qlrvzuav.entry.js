import{r as t,c as e,h as i}from"./p-df6a2f70.js";import"./p-d8060b98.js";import{f as o,s,d as n,j as l,k as c,r as a,o as h,a as d}from"./p-08b2255d.js";class r{constructor(i){t(this,i),this.columns=1,this.sortEnabled=!1,this.filterEnabled=!1,this.multiSelection=!1,this.showSelection=!0,this.enableRowActions=!1,this.globalFilterValue="",this.collapsedSection={},this.selectedRows=[],this.visibleColumns=[],this.rows=[],this.kupBoxClicked=e(this,"kupBoxClicked",6),this.kupBoxSelected=e(this,"kupBoxSelected",6),this.kupAutoBoxSelect=e(this,"kupAutoBoxSelect",6),this.kupRowActionMenuClicked=e(this,"kupRowActionMenuClicked",6),this.kupRowActionClicked=e(this,"kupRowActionClicked",6)}recalculateRows(){this.initRows()}onDataChanged(){this.initVisibleColumns(),this.initRows(),this.checkLayout()}onLayoutChanged(){this.checkLayout()}onSelectBoxChanged(){this.handleAutomaticBoxSelection()}componentWillLoad(){this.onDataChanged()}componentDidLoad(){this.handleAutomaticBoxSelection(),document.addEventListener("click",this.clickFunction.bind(this))}componentDidUnload(){document.removeEventListener("click",this.clickFunction.bind(this))}async loadRowActions(t,e){t.actions=e,this.rowActionMenuOpened=t}getColumns(){return this.data&&this.data.columns?this.data.columns:[{title:"",name:"",size:0}]}initVisibleColumns(){this.visibleColumns=this.getColumns().filter(t=>!t.hasOwnProperty("visible")||t.visible)}getRows(){return this.data&&this.data.rows?this.data.rows:[]}initRows(){let t=this.getRows();if(this.filterEnabled&&this.globalFilterValue){const e=this.visibleColumns;let i=e.length,s=[],n=0;for(;i-- >0;)s.push(e[n++].name);t=o(t,null,this.globalFilterValue,s)}this.rows=this.sortRows(t)}sortRows(t){let e=t;return this.sortBy&&(e=s(e,[{column:this.sortBy,sortMode:d.A}])),e}checkLayout(){if(this.layout)return void(this.boxLayout=this.layout);const t={horizontal:!1,sections:[],style:{textAlign:"center"}},e=this.visibleColumns;let i=e.length,o=[],s=0;for(;i-- >0;)o.push({column:e[s++].name});t.content=o,this.boxLayout={sections:[t]}}onSortChange(t){this.sortBy=t.value.id,this.initRows()}onGlobalFilterChange({detail:t}){this.globalFilterValue=t.value}isSectionExpanded(t,e){return!(!t.id||!e.id)&&this.collapsedSection[e.id]&&this.collapsedSection[e.id][t.id]}handleAutomaticBoxSelection(){this.selectBox&&this.selectBox>0&&this.selectBox<=this.rows.length&&(this.selectedRows=[],this.selectedRows.push(this.rows[this.selectBox-1]),this.kupAutoBoxSelect.emit({row:this.selectedRows[0]}))}checkIfElementIsActionMenuIcon(t){return!(!t.tagName||!t.parentElement)&&"svg"===t.tagName&&t.parentElement.classList.contains("row-actions-toggler")}onBoxClick({target:t},e){if(!(t instanceof HTMLElement))return;let i=t,o=i.classList;for(;!o.contains("box-object")&&!o.contains("box-section")&&!o.contains("box")&&null!==(i=i.parentElement);)o=i.classList;let s=null;o.contains("box-object")&&(s=i.dataset.column),this.kupBoxClicked.emit({row:e,column:s}),this.multiSelection?this.onSelectionCheckChange(e):this.selectedRows=[e]}onSelectionCheckChange(t){const e=this.selectedRows.indexOf(t);e>=0?(this.selectedRows.splice(e,1),this.selectedRows=[...this.selectedRows]):this.selectedRows=[...this.selectedRows,t],this.kupBoxSelected.emit({rows:this.selectedRows})}toggleSectionExpand(t,e){if(e.id)if(t.id){if(this.collapsedSection[e.id]){const i=this.collapsedSection[e.id];i[t.id]=!i[t.id]||!i[t.id]}else this.collapsedSection[e.id]={},this.collapsedSection[e.id][t.id]=!0;this.collapsedSection=Object.assign({},this.collapsedSection)}else console.error("cannot expand / collapse a section of a row without ad id");else console.error("cannot expand / collapse a section withoun an ID")}onRowAction(t){t&&(t!==this.rowActionMenuOpened?t.actions?this.rowActionMenuOpened=t:this.kupRowActionMenuClicked.emit({row:t}):this.rowActionMenuOpened=null)}onRowActionClicked(t,e,i){this.kupRowActionClicked.emit({row:t,action:e,index:i})}clickFunction(t){try{const e=t.composedPath();for(let t of e)if(this.checkIfElementIsActionMenuIcon(t))return}catch(e){if(this.checkIfElementIsActionMenuIcon(t.target))return}this.rowActionMenuOpened=null}renderRow(t){const e=[...this.visibleColumns];let o=null,s=t.layout;s||(s=this.boxLayout);let n=!1;if(s){s.horizontal&&(n=!0);const i=s.sections;let l=i.length,c=0;l>0&&(o=[]);const a={horizontal:n};for(;l-- >0;)o.push(this.renderSection(i[c++],a,t,e))}const l=this.selectedRows.includes(t);let c=null;this.multiSelection&&(c=i("div",{class:"box-selection"},i("input",{type:"checkbox",checked:l,onClick:t=>t.stopPropagation(),onChange:()=>this.onSelectionCheckChange(t)})));let a=null;if(this.enableRowActions){const e={"row-action-menu":!0,open:t===this.rowActionMenuOpened};let o=null;if(t.actions){const e=t.actions.map((e,o)=>i("li",{tabindex:"0",onClick:()=>this.onRowActionClicked(t,e,o)},i("div",{class:`icon ${e.icon}`}),i("div",{class:"text"},e.text)));o=i("ul",null,e)}a=i("div",{class:"row-actions-wrapper"},i("div",{class:"row-actions-toggler"},i("svg",{version:"1.1",width:"24",height:"24",viewBox:"0 0 24 24",onClick:()=>this.onRowAction(t)},i("path",{d:"M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"})),i("div",{class:e},o)))}let h=null;return t.badges&&t.badges.length>0&&(h=t.badges.map(t=>i("kup-badge",{text:t.text,position:t.position,icon:t.icon,class:"centered"}))),i("div",{class:"box-wrapper"},i("div",{class:{box:!0,selected:this.showSelection&&l,column:!n},onClick:e=>this.onBoxClick(e,t)},c,o,h),a)}renderSection(t,e,o,s){let n=null;if(t.sections&&t.sections.length>0){const e=t.sections;let i=e.length,l=0;for(i>0&&(n=[]);i-- >0;)n.push(this.renderSection(e[l++],t,o,s))}else if(t.content){const e=t.content;let i=e.length,l=0;for(i>0&&(n=[]);i-- >0;)n.push(this.renderBoxObject(e[l++],o,s))}else if(s.length>0){const t=s[0];s.splice(0,1),n=this.renderBoxObject({column:t.name},o,s)}const l=this.isSectionExpanded(o,t),c=!!t.columns,a={"box-section":!0,open:l,column:!c&&!t.horizontal,grid:c,titled:!!t.title,"last-child":!t.sections||0===t.sections.length},h=t.style||{};t.dim&&e&&(h.flex=`0 0 ${t.dim}`,e.horizontal?h.maxWidth=t.dim:h.maxHeight=t.dim),c&&(h["grid-template-columns"]=`repeat(${t.columns}, 1fr)`);let d=null;if(t.collapsible){a["collapse-section"]=!0;let e="";e=t.title?t.title:l?"Collassa":"Espandi",d=i("div",{class:a,style:h},i("div",{class:{content:!0}},n),i("div",{class:"header",role:"button",onClick:e=>{e.stopPropagation(),this.toggleSectionExpand(o,t)}},i("div",{class:"header-content"},i("span",null,e),i("span",{class:"mdi mdi-chevron-down"}))))}else{const e=t.title?i("h3",null,t.title):null;d=i("div",{class:a,style:h},e,n)}return d}renderBoxObject(t,e,o){let s=null,d={};if(t.value)s=t.value;else if(t.column){const r=e.cells[t.column];if(r){let e=-1;for(let i=0;i<o.length;i++)if(o[i].name===t.column){e=i;break}if(e>=0&&o.splice(e,1),r.style&&(d=Object.assign({},r.style)),n(r.obj)){let t=null;r.config&&r.config.badges&&(t=r.config.badges),s=i("kup-image",{src:r.value,badges:t})}else if(l(r.obj))s=i("kup-button",Object.assign({},c(r)));else if(a(r.obj)){const t=h(r.value).value();let e=!1,o=null;const n={};r.config&&(e=!!r.config.hideLabel,r.config.hasOwnProperty("labelText")&&(o=r.config.labelText),r.config.foregroundColor&&(n["--kup-pb_foreground-color"]=r.config.foregroundColor)),s=i("div",{style:n},i("kup-progress-bar",{value:t,labelText:o,hideLabel:e}))}else s=r.value}}return i("div",{"data-column":t.column,class:"box-object",style:d},s)}render(){let t=null;if(this.sortEnabled){let e={value:"",id:""};const o=[{value:"",id:""},...this.visibleColumns.map(t=>{const i={value:t.title,id:t.name};return t.name===this.sortBy&&(e=i),i})];t=i("div",{id:"sort-panel"},i("kup-combo",{displayedField:"value",items:o,initialValue:e,onKetchupComboSelected:t=>this.onSortChange(t.detail)}))}let e=null;this.filterEnabled&&(e=i("div",{id:"filter-panel"},i("kup-text-input",{placeholder:"Cerca",onKetchupTextInputUpdated:t=>this.onGlobalFilterChange(t)},i("svg",{slot:"left",version:"1.1",width:"18",height:"18",viewBox:"0 0 24 24"},i("path",{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"})))));let o=null;if(0===this.rows.length)o=i("p",{id:"empty-data-message"},"Empty data");else{const t=this.rows;let e=t.length,i=0;for(o=[];e-- >0;)o.push(this.renderRow(t[i++]))}return i("div",null,t,e,i("div",{id:"box-container",style:{"grid-template-columns":`repeat(${this.columns}, 1fr)`}},o))}static get watchers(){return{globalFilterValue:["recalculateRows"],sortBy:["recalculateRows"],data:["onDataChanged"],layout:["onLayoutChanged"],selectBox:["onSelectBoxChanged"]}}static get style(){return"\@import url(https://cdn.materialdesignicons.com/3.6.95/css/materialdesignicons.min.css);:host{--box_color:var(--kup-box_color,#707070);--box_border-color:var(--kup-box_border-color,#d0d0d0);--box_border-radius:var(--kup-box_border-radius,3px);--box_img-border-radius:var(--kup-box_img-border-radius,4px);--box_expand-panel-color:var(--kup-box_expand-panel-color,$smeup-primary);--box_hover-box-shadow:var(--kup-box_hover-box-shadow,0px 0px 7.5px 0px hsla(0,0%,50.2%,0.5));--box_titled-section-font-size:var(--kup-box_titled-section-font-size,12px);--box_titled-section-bg-color:var(--kup-box_titled-section-bg-color,#fff);--box_titled-section-top:var(--kup-box_titled-section-top,-9px)}#box-container{display:grid;grid-gap:1rem;color:var(--box_color)}#box-container *{-webkit-box-sizing:border-box;box-sizing:border-box}#box-container .box-wrapper{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#box-container .box-wrapper .box{-ms-flex-positive:1;flex-grow:1;cursor:pointer;position:relative;border-radius:var(--box_border-radius);border:1px solid var(--box_border-color);display:-ms-flexbox;display:flex;padding:3px}#box-container .box-wrapper .box.column{-ms-flex-direction:column;flex-direction:column}#box-container .box-wrapper .box.selected,#box-container .box-wrapper .box:hover{-webkit-box-shadow:var(--box_hover-box-shadow);box-shadow:var(--box_hover-box-shadow)}#box-container .box-wrapper .box .box-section{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex:1 1 1%;flex:1 1 1%;-ms-flex-wrap:wrap;flex-wrap:wrap}#box-container .box-wrapper .box .box-section.last-child{margin:3px 4px}#box-container .box-wrapper .box .box-section.column{-ms-flex-direction:column;flex-direction:column;-ms-flex-pack:center;justify-content:center;-ms-flex-wrap:unset;flex-wrap:unset}#box-container .box-wrapper .box .box-section.column>.box-section{-ms-flex:0 0 auto;flex:0 0 auto}#box-container .box-wrapper .box .box-section.grid{display:grid}#box-container .box-wrapper .box .box-section .box-object{padding:1px 4px}#box-container .box-wrapper .box .box-section .box-object img{border-radius:var(--box_img-border-radius);height:auto}#box-container .box-wrapper .box .box-section.collapse-section .header{border-top:1px solid var(--box_border-color);color:var(--box_expand-panel-color);display:-ms-flexbox;display:flex;-ms-flex-pack:distribute;justify-content:space-around;width:100%}#box-container .box-wrapper .box .box-section.collapse-section .header .header-content{margin:.5rem;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}#box-container .box-wrapper .box .box-section.collapse-section .header .header-content .mdi{margin-left:5px}#box-container .box-wrapper .box .box-section.collapse-section .content{display:none;width:100%}#box-container .box-wrapper .box .box-section.collapse-section.open .header .header-content .mdi:before{-webkit-animation:rotate-icon .5s ease-out forwards;animation:rotate-icon .5s ease-out forwards}#box-container .box-wrapper .box .box-section.collapse-section.open .content{display:block}#box-container .box-wrapper .box .box-section.titled{border:1px solid var(--box_border-color);padding-top:5px;position:relative;margin:10px}#box-container .box-wrapper .box .box-section.titled>h3{position:absolute;margin:0;padding:0 3px;top:var(--box_titled-section-top);left:5px;font-size:var(--box_titled-section-font-size);background:var(--box_titled-section-bg-color)}#box-container .box-wrapper .box .box-selection{position:absolute;top:.5rem;right:.5rem}#box-container .box-wrapper .box kup-badge{--bdg_background-color:#f89406;--kup-badge_dimension:24px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler{position:relative;width:24px;height:24px;margin-left:3px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler svg{cursor:pointer;opacity:0;fill:#545454;-webkit-transition:opacity .5s ease-out;transition:opacity .5s ease-out}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu{position:absolute;top:0;right:24px;display:none;border:1px solid var(--box_border-color);z-index:10;background:#fff;-webkit-box-shadow:0 0 7.5px 0 hsla(0,0%,50.2%,.5);box-shadow:0 0 7.5px 0 hsla(0,0%,50.2%,.5)}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul{list-style-type:none;margin:0;padding:0}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li{cursor:pointer;white-space:nowrap;padding:0 12px;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;line-height:30px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li:not(:last-child){border-bottom:1px solid var(--box_border-color)}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu ul>li .icon{margin-right:5px}#box-container .box-wrapper .row-actions-wrapper .row-actions-toggler .row-action-menu.open{display:block}#box-container .box-wrapper:hover .row-actions-wrapper .row-actions-toggler svg{opacity:1}:host(.no-shadow) #box-container .box{border:none}:host(.no-shadow) #box-container .box.selected,:host(.no-shadow) #box-container .box:hover{-webkit-box-shadow:none;box-shadow:none}#filter-panel,#sort-panel{margin-bottom:1rem}#filter-panel kup-text-input{--kup-text-input_border-color:#d0d0d0;--kup-text-input_color:#545454}#filter-panel svg{fill:grey;margin-left:3px}\@-webkit-keyframes rotate-icon{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}\@-moz-keyframes rotate-icon{0%{transform:rotate(0deg)}to{transform:rotate(180deg)}}\@-o-keyframes rotate-icon{0%{transform:rotate(0deg)}to{transform:rotate(180deg)}}\@keyframes rotate-icon{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(180deg);transform:rotate(180deg)}}"}}export{r as kup_box};