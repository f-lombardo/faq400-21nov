import{r as e,c as t,h as s}from"./p-df6a2f70.js";import"./p-d8060b98.js";import{i,b as n,e as l,h as a,j as d,m as o,q as r}from"./p-6abc1eda.js";const h="isExpanded";class c{constructor(s){e(this,s),this.data=[],this.expanded=!1,this.showColumns=!1,this.showHeader=!1,this.showIcons=!0,this.selectedNode=[],this.showObjectNavigation=!1,this.useDynamicExpansion=!1,this.dynamicExpansionCallback=void 0,this.visibleColumns=[],this.selectedNodeString="",this.stateSwitcher=!1,this.kupOptionClicked=t(this,"kupOptionClicked",6),this.kupTreeNodeCollapse=t(this,"kupTreeNodeCollapse",6),this.kupTreeNodeExpand=t(this,"kupTreeNodeExpand",6),this.kupTreeNodeSelected=t(this,"kupTreeNodeSelected",6)}componentWillLoad(){this.data&&this.data.forEach(e=>{this.enrichWithIsExpanded(e,this.expanded&&!this.useDynamicExpansion&&!e.disabled)}),Array.isArray(this.selectedNode)&&(this.selectedNodeString=this.selectedNode.toString())}enrichDataWhenChanged(e,t){e!==t&&e.forEach(e=>{this.enrichWithIsExpanded(e,this.expanded&&!this.useDynamicExpansion&&!e.disabled)})}selectedNodeToStr(e){Array.isArray(e)&&(this.selectedNodeString=e.toString())}enrichWithIsExpanded(e,t=!1){if(e.expandable&&(e[h]=e.hasOwnProperty(h)&&e[h]||t,e.children&&e.children.length))for(let s=0;s<e.children.length;s++)e.children[s].expandable&&this.enrichWithIsExpanded(e.children[s],t&&!e.children[s].disabled)}forceUpdate(){this.stateSwitcher=!this.stateSwitcher}hdlTreeNodeClicked(e,t){e.disabled||this.kupTreeNodeSelected.emit({treeNodePath:t.split(",").map(e=>parseInt(e)),treeNode:e})}hdlTreeNodeExpanderClicked(e,t){if(e.expandable){const s=t.split(",").map(e=>parseInt(e));e.children&&e.children.length?(e[h]=!e[h],this.forceUpdate(),e[h]?this.kupTreeNodeExpand.emit({treeNodePath:s,treeNode:e,usesDynamicExpansion:this.useDynamicExpansion}):this.kupTreeNodeCollapse.emit({treeNodePath:s,treeNode:e})):this.useDynamicExpansion&&!this.expanded&&(this.dynamicExpansionCallback?this.dynamicExpansionCallback(e,s).then(t=>{e.children=t,e[h]=!e[h],this.forceUpdate(),this.kupTreeNodeExpand.emit({treeNodePath:s,treeNode:e,usesDynamicExpansion:!0})}).catch(t=>{console.error("KupTree: An error occurred when trying to fetch dynamicExpansion nodes data",t,e)}):this.kupTreeNodeExpand.emit({treeNode:e,treeNodePath:s,usesDynamicExpansion:!0,dynamicExpansionRequireChildren:!0}))}}hdlOptionClicked(e,t,s,i){e.stopPropagation(),this.kupOptionClicked.emit({cell:t,column:s,treeNode:i})}selectedNodeToString(e){let t="";if(e&&e.length){t=e[0].toString();for(let s=1;s<e.length;s++)t+=`,${e[0]}`}return t}renderOptionElement(e,t,i){return s("span",{"aria-label":"Opzioni oggetto",class:"options mdi mdi-settings",role:"button",title:"Opzioni oggetto",onClick:s=>this.hdlOptionClicked(s,e,t,i)})}renderCell(e,t,h){const c=h!==e.value?e.value:"";let p=c;if(i(e.obj)||n(e.obj))p=s("span",{class:c});else if(l(e.obj))p=s("img",{src:c,alt:"",width:"64",height:"64"});else if(a(e.obj))p=s("a",{href:c,target:"_blank"},c);else if(d(e.obj))p=s("kup-checkbox",{checked:!!e.obj.k,disabled:!t.treeNode.hasOwnProperty("readOnly")||t.treeNode.readOnly});else if(o(e.obj)){const t={value:e.value};p=c?s("kup-graphic-cell",Object.assign({},t)):null}let u=[];return u.push(s("span",{class:"cell-content",style:r(e)?e.style:null},p)),!t.treeNode.disabled&&e.options&&this.showObjectNavigation&&u.push(this.renderOptionElement(e,t.column,t.treeNode)),s("td",{style:r(e)?null:e.style},u)}renderHeader(){return this.visibleColumns.map(e=>s("th",null,s("span",{class:"column-title"},e.title)))}renderTreeNode(e,t,i=0){let n=i?s("span",{class:"kup-tree__indent",style:{"--tree-node_depth":i.toString()}}):null;const l=!(!e.expandable||!(e.children&&e.children.length||this.useDynamicExpansion));let a=s("span",{class:"kup-tree__icon kup-tree__node__expander"+(l?" mdi mdi-menu-down":""),onClick:l&&!e.disabled?()=>this.hdlTreeNodeExpanderClicked(e,t):null}),d=this.showIcons?s("span",{class:"kup-tree__icon mdi mdi-"+e.iconClass}):null,o={};e.hasOwnProperty(h)&&e[h]&&l&&(o["data-is-expanded"]=e[h]);let r=null;e.disabled||(o.onClick=()=>{this.hdlTreeNodeClicked(e,t)},e.options&&this.showObjectNavigation&&(r=this.renderOptionElement({obj:e.obj,value:e.value},{name:"TreeNodeCell",title:"TreeNodeCell"},e)));let c=null;if(this.showColumns&&this.visibleColumns&&this.visibleColumns.length){c=[];for(let t=0;t<this.visibleColumns.length;t++){const s=this.visibleColumns[t];c.push(this.renderCell(e.cells[s.name],{column:s,treeNode:e}))}}return s("tr",Object.assign({class:{"kup-tree__node":!0,"kup-tree__node--disabled":e.disabled,"kup-tree__node--selected":!e.disabled&&t===this.selectedNodeString},"data-tree-path":t},o),s("td",{style:e.style||null},n,a,d,s("span",{class:"cell-content"},e.value),r),c)}renderTree(e,t,s=0){let i=[];if(e&&(i.push(this.renderTreeNode(e,t,s)),e.expandable&&e.children&&e.children.length&&e[h]))for(let n=0;n<e.children.length;n++)i=i.concat(this.renderTree(e.children[n],t+","+n,s+1));return i}render(){this.showColumns&&this.columns&&(this.visibleColumns=this.columns.filter(e=>!e.hasOwnProperty("visible")||e.visible));let e=[];this.data&&this.data.length?this.data.forEach((t,s)=>{e=e.concat(this.renderTree(t,s.toString()))}):e.push(s("tr",null,s("td",null,"Nessun elemento nell'albero")));const t=this.showHeader&&this.showColumns;return[s("link",{href:"https://cdn.materialdesignicons.com/3.2.89/css/materialdesignicons.min.css",rel:"stylesheet",type:"text/css"}),s("table",{class:"kup-tree","data-show-columns":this.showColumns,"data-show-object-navigation":this.showObjectNavigation},s("thead",{class:{"header--is-visible":t}},s("tr",null,s("th",null),t?this.renderHeader():null)),s("tbody",null,e))]}static get watchers(){return{data:["enrichDataWhenChanged"],selectedNode:["selectedNodeToStr"]}}static get style(){return":host{--tre_node-expander_background-color:var(--kup-tre_node-expander_background-color,#e0e0e0);--tre_node-expander_color:var(--kup-tre_node-expander_color,#545454);--tre_node_background-color--hover:var(--kup-tre_node_background-color--hover,#e6e6e6);--tre_node-icon_color:var(--kup-tre_node-icon_color,#545454);--tre_node-icon_size:var(--kup-tre_node-icon_size,16px);--tre_node-indent_width:var(--kup-tre_node-indent_width,16px);--tre_node--disabled_opacity:var(--kup-tre_node--disabled_opacity,.7);--tre_table_border-bottom-color:var(--kup-tre_table_border-bottom-color,#e0e0e0);--tre_table-header_background-color:var(--kup-tre_table-header_background-color,grey);--tre_table-header_color:var(--kup-tre_table-header_color,#fff);--tre_table-header_font-weight:var(--kup-tre_table-header_font-weight,400);display:block}.kup-tree{border-collapse:collapse;width:100%}.kup-tree thead{display:none}.kup-tree thead.header--is-visible{display:table-header-group}.kup-tree thead th{background-color:var(--tre_table-header_background-color);color:var(--tre_table-header_color);font-weight:var(--tre_table-header_font-weight);text-align:left}.kup-tree__indent{display:inline-block;width:calc(var(--tre_node-indent_width) * var(--tree-node_depth, 0))}.kup-tree .options,.kup-tree__icon{-ms-flex-align:center;align-items:center;color:var(--tre_node-icon_color);display:-ms-inline-flexbox;display:inline-flex;font-size:var(--tre_node-icon_size);height:var(--tre_node-icon_size);-ms-flex-pack:center;justify-content:center;width:var(--tre_node-icon_size)}.kup-tree__node>*{vertical-align:middle}.kup-tree__node--disabled{opacity:var(--tre_node--disabled_opacity)}.kup-tree__node--disabled .kup-tree__node__expander{cursor:auto;pointer-events:none}.kup-tree__node__expander{border-radius:50%;color:var(--tre_node-expander_color);cursor:pointer;-webkit-transition:background-color .4s,-webkit-box-shadow .4s,-webkit-transform .4s;transition:background-color .4s,-webkit-box-shadow .4s,-webkit-transform .4s;transition:background-color .4s,box-shadow .4s,transform .4s;transition:background-color .4s,box-shadow .4s,transform .4s,-webkit-box-shadow .4s,-webkit-transform .4s}.kup-tree__node__expander:hover{background-color:var(--tre_node-expander_background-color);-webkit-box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24)}.kup-tree__node[data-is-expanded] .kup-tree__node__expander{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.kup-tree__node[data-is-expanded] .kup-tree__node__expander:hover{-webkit-box-shadow:rgba(0,0,0,.12) 0 -1px 3px,rgba(0,0,0,.24) 0 -1px 2px;box-shadow:0 -1px 3px rgba(0,0,0,.12),0 -1px 2px rgba(0,0,0,.24)}.kup-tree__node .options{cursor:pointer;float:right;margin-left:8px;opacity:0;-webkit-transition:opacity .6s,visibility .6s;transition:opacity .6s,visibility .6s}.kup-tree__node .options:before{height:inherit;width:inherit}.kup-tree__node--selected>td,.kup-tree__node:hover>td{background-color:var(--tre_node_background-color--hover)}.kup-tree[data-show-columns] .kup-tree__node{border-bottom:solid 1px var(--tre_table_border-bottom-color)}.kup-tree[data-show-object-navigation] .kup-tree__node:hover .options{opacity:1;visibility:visible}.kup-tree[data-show-object-navigation] .kup-tree__node:hover .options:hover{opacity:.54}"}}export{c as kup_tree};